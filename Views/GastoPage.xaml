<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="app_s8.Views.GastoPage"
             Title="GastoPage">
    <VerticalStackLayout>
        <ScrollView>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Formulario CRUD -->
                <Frame Grid.Row="0" BackgroundColor="LightGray" Padding="15" Margin="10">
                    <StackLayout>
                        <Label Text="Formulario de Gastos" 
                           FontSize="18" 
                           FontAttributes="Bold" 
                           HorizontalOptions="Center" 
                           Margin="0,0,0,15"/>

                        <Entry x:Name="EntryMonto" 
                           Placeholder="Monto" 
                           Keyboard="Numeric"/>

                        <Entry x:Name="EntryCategoria" 
                           Placeholder="Categoría"/>

                        <DatePicker x:Name="DatePickerFecha" 
                                Format="dd/MM/yyyy"/>

                        <Entry x:Name="EntryDescripcion" 
                           Placeholder="Descripción"/>

                        <Entry x:Name="EntryCuenta" 
                           Placeholder="Cuenta"/>

                        <Editor x:Name="EditorNota" 
                            Placeholder="Nota" 
                            HeightRequest="60"/>

                        <StackLayout Orientation="Horizontal" 
                                 HorizontalOptions="CenterAndExpand" 
                                 Margin="0,15,0,0">

                            <Button x:Name="BtnGuardar" 
                                Text="Guardar" 
                                BackgroundColor="Green" 
                                TextColor="White" 
                                Clicked="OnGuardarClicked"/>

                            <Button x:Name="BtnActualizar" 
                                Text="Actualizar" 
                                BackgroundColor="Orange" 
                                TextColor="White" 
                                Clicked="OnActualizarClicked"
                                IsVisible="False"/>

                            <Button x:Name="BtnCancelar" 
                                Text="Cancelar" 
                                BackgroundColor="Gray" 
                                TextColor="White" 
                                Clicked="OnCancelarClicked"/>

                        </StackLayout>
                    </StackLayout>
                </Frame>

                <!-- Lista de Gastos -->
                <StackLayout Grid.Row="1" Margin="10">
                    <Label Text="Lista de Gastos" 
                       FontSize="16" 
                       FontAttributes="Bold" 
                       Margin="0,10"/>

                    <Button Text="Cargar Gastos" 
                        BackgroundColor="Blue" 
                        TextColor="White" 
                        Clicked="OnCargarGastosClicked" 
                        Margin="0,0,0,10"/>

                    <CollectionView x:Name="CollectionViewGastos" 
                                SelectionMode="Single" 
                                SelectionChanged="OnGastoSeleccionado">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="15" 
                                  BackgroundColor="White" 
                                  Margin="0,2">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <StackLayout Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2">
                                        <Label Text="{Binding Categoria}" 
                                           FontSize="16" 
                                           FontAttributes="Bold"/>
                                        <Label Text="{Binding Monto, StringFormat='${0:F2}'}" 
                                           FontSize="14" 
                                           TextColor="Green"/>
                                    </StackLayout>

                                    <StackLayout Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2">
                                        <Label Text="{Binding Descripcion}" 
                                           FontSize="12"/>
                                        <Label Text="{Binding Cuenta}" 
                                           FontSize="12" 
                                           TextColor="Gray"/>
                                    </StackLayout>

                                    <Label Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2"
                                       Text="{Binding Nota}" 
                                       FontSize="10" 
                                       TextColor="DarkGray"/>

                                    <Button Grid.Row="3" Grid.Column="1"
                                        Text="Eliminar" 
                                        BackgroundColor="Red" 
                                        TextColor="White" 
                                        FontSize="12"
                                        Padding="10,5"
                                        Clicked="OnEliminarClicked"
                                        CommandParameter="{Binding .}"/>

                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </StackLayout>

            </Grid>
        </ScrollView>
    </VerticalStackLayout>
</ContentPage>