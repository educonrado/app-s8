<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:microcharts="clr-namespace:Microcharts.Maui;assembly=Microcharts.Maui"
             x:Class="app_s8.Views.IngresoPage"
             Title="IngresoPage">

    <ScrollView>
        <StackLayout Padding="20" Spacing="15">
            <Label Text="Registro de ingresos"
               VerticalOptions="Center" 
               FontSize="Title"
               HorizontalOptions="Center" />
            <!-- Botones tipo toggle para los gráficos -->
            <StackLayout Orientation="Horizontal" HorizontalOptions="Center" Spacing="10">
                <Button x:Name="btnPorFecha" Text="Por Fecha" Clicked="OnPag1Clicked" BackgroundColor="#E0E0E0"/>
                <Button x:Name="btnPorCategoria" Text="Por Categoría" Clicked="OnPag2Clicked" BackgroundColor="#E0E0E0"/>
                <Button x:Name="btnResumen" Text="Resumen" Clicked="OnPag3Clicked" BackgroundColor="#E0E0E0"/>
            </StackLayout>

            <!-- Resumen de ingresos -->
            <Frame BackgroundColor="White" Padding="10" CornerRadius="10" HasShadow="True">
                <StackLayout>
                    <Label x:Name="lblTotalIngresos" Text="$0.00" FontSize="24" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                    <Label Text="+20% mes a mes" FontSize="12" HorizontalTextAlignment="Center" TextColor="Green"/>
                </StackLayout>
            </Frame>

            <Frame BackgroundColor="White" Padding="10" CornerRadius="10" HasShadow="True">
                <StackLayout>
                    <Label x:Name="lblCantidadIngresos" Text="0" FontSize="24" FontAttributes="Bold" HorizontalTextAlignment="Center"/>
                    <Label Text="+33% transacciones" FontSize="12" HorizontalTextAlignment="Center" TextColor="Green"/>
                </StackLayout>
            </Frame>
            <!-- formulario de ingreso-->
            <Label Text="Monto" />
            <Entry x:Name="montoEntry" 
                   Placeholder="0.00" 
                   Keyboard="Numeric" />
            <Label Text="Categoría" />
            <Picker x:Name="categoriaPicker" 
                    Title="Seleccionar categoría">
                <Picker.ItemsSource>
                    <x:Array Type="{x:Type x:String}">
                        <x:String>Salario</x:String>
                        <x:String>Freelance</x:String>
                        <x:String>Inversiones</x:String>
                        <x:String>Ventas</x:String>
                        <x:String>Bonos</x:String>
                        <x:String>Regalos</x:String>
                        <x:String>Otros</x:String>
                    </x:Array>
                </Picker.ItemsSource>
            </Picker>

            <Label Text="Fecha" />
            <DatePicker x:Name="fechaDatePicker" />

            <Label Text="Descripción" />
            <Entry x:Name="descripcionEntry" 
                   Placeholder="Descripción del ingreso" />

            <Label Text="Cuenta" />
            <Picker x:Name="cuentaPicker" 
                    Title="Seleccionar cuenta">
                <Picker.ItemsSource>
                    <x:Array Type="{x:Type x:String}">
                        <x:String>Efectivo</x:String>
                    </x:Array>
                </Picker.ItemsSource>
            </Picker>

            <Label Text="Nota" />
            <Editor x:Name="notaEditor" 
                    Placeholder="Notas adicionales (opcional)"
                    HeightRequest="80" />
            <StackLayout Orientation="Horizontal" 
                         HorizontalOptions="FillAndExpand"
                         Spacing="10"
                         Margin="0,20,0,0">

                <Button x:Name="cancelarButton"
                        Text="Cancelar"
                        HorizontalOptions="FillAndExpand"
                        Clicked="OnCancelarClicked" />

                <Button x:Name="guardarButton"
                        Text="Guardar"
                        HorizontalOptions="FillAndExpand"
                        Clicked="OnGuardarClicked" />

            </StackLayout>
            <Border>
                <StackLayout Padding="15">
                    <Label Text="Listado de ingresos" 
                           FontSize="16" 
                           FontAttributes="Bold"
                           HorizontalTextAlignment="Center"
                           Margin="0,0,0,10"/>
                    <ListView ItemsSource="{Binding TransaccionesViewModel.Transacciones}" HasUnevenRows="True">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <ViewCell>
                                    <Grid ColumnDefinitions="80,*,90" Padding="10">
                                        <Label Grid.Column="0" Text="{Binding FechaFormateada}"/>
                                        <Label Grid.Column="1" Text="{Binding Descripcion}"/>
                                        <Label Grid.Column="2" 
                                               Text="{Binding MontoFormateado}"
                                               HorizontalOptions="EndAndExpand"
                                               FontAttributes="Bold"
                                               FontSize="14"/>
                                    </Grid>
                                </ViewCell>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                    <!-- Gráfico por Fecha -->
                    <microcharts:ChartView x:Name="chartPorFecha" HeightRequest="200" IsVisible="False" />

                    <!-- Gráfico por Categoría -->
                    <microcharts:ChartView x:Name="chartPorCategoria" HeightRequest="200" IsVisible="False" />

                    <!-- Gráfico Resumen -->
                    <microcharts:ChartView x:Name="chartResumen" HeightRequest="200" IsVisible="False" />
                </StackLayout>
            </Border>

        </StackLayout>
    </ScrollView>
</ContentPage>